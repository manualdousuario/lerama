#!/bin/bash
set -e

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

log_success() {
    echo -e "${GREEN}[âœ“] $1${NC}"
}

log_info() {
    echo -e "${YELLOW}[i] $1${NC}"
}

# Create .env file with environment variables
log_info "Setting up environment variables in /app/.env..."
touch /app/.env
cat > /app/.env << EOL
APP_NAME=Lerama
APP_URL=${APP_URL:-https://lerama.lab}
LERAMA_DB_HOST=${LERAMA_DB_HOST:-localhost}
LERAMA_DB_PORT=${LERAMA_DB_PORT:-3306}
LERAMA_DB_NAME=${LERAMA_DB_NAME:-lerama}
LERAMA_DB_USER=${LERAMA_DB_USER:-root}
LERAMA_DB_PASS=${LERAMA_DB_PASS:-root}
ADMIN_USERNAME=${ADMIN_USERNAME:-admin}
ADMIN_PASSWORD=${ADMIN_PASSWORD:-admin}
PROXY_LIST=${PROXY_LIST:-}
ADMIN_EMAIL=${ADMIN_EMAIL:-admin@example.com}
SMTP_HOST=${SMTP_HOST:-}
SMTP_PORT=${SMTP_PORT:-587}
SMTP_USERNAME=${SMTP_USERNAME:-}
SMTP_PASSWORD=${SMTP_PASSWORD:-}
SMTP_SECURE=${SMTP_SECURE:-tls}
SMTP_FROM_EMAIL=${SMTP_FROM_EMAIL:-lerama@example.com}
SMTP_FROM_NAME=${SMTP_FROM_NAME:-"Lerama"}
EOL

log_success "Environment variables set in /app/.env"

# Update proxy list if PROXY_LIST environment variable is defined
if [ -n "$PROXY_LIST" ]; then
    log_info "PROXY_LIST environment variable detected, will update proxy list after startup..."
fi